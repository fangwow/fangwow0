<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="keywords" content="hexo,个人博客,blog">
  <meta name="description" content="个人博客">
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://busuanzi.ibruce.info">
  
  <link rel="dns-prefetch" href="https://widget.daovoice.io">
  <link rel="dns-prefetch" href="https://widget-static-cdn.daovoice.io">
  <link rel="dns-prefetch" href="https://im.daovoice.io">
  
  
  <link rel="dns-prefetch" href="https://hm.baidu.com/">
  
  
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://api.github.com">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com">
  
  <link rel="stylesheet" type="text/css" href="/songfang0/./style/main.d9e3dd.css">
	<link rel="shortcut icon" href="/favicon.ico" title="Favicon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
	<title>Node项目</title>
  
  <script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?awwssw1snsnsnn1ndndnndnd99j";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();
  </script>
  
  
    <script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/123456.js","daovoice");daovoice('init',{app_id: "123456"});daovoice('update');
  </script>
  
</head>
<body>
<canvas id="pattern-placeholder" height="230"></canvas>
<div class="navbar-header">
  <a class="blog-title" href="/songfang0/">web前端总结</a>
  <a class="face-img" href="/songfang0/">
    <img src="https://tse1-mm.cn.bing.net/th?id=OIP.Wo0E2kACycBZa4AF_UoUjwAAAA&amp;w=97&amp;h=100&amp;c=8&amp;rs=1&amp;qlt=90&amp;pid=3.1&amp;rm=2">
  </a>
</div>
<main>
  <div class="article-title">
    
  
  <h1 class="title">
    Node项目
  </h1>
  


    <ul class="article-info">
      <li>
        发布
        <time datetime="2019-04-25T16:05:37.000Z" itemprop="datePublished">2019-04-26</time>
      </li>
      <li>
        
    更新 <time datetime="2019-04-25T16:10:38.981Z" itemprop="dateUpdated">2019-04-26</time>

      </li>
      <li id="busuanzi_container_page_pv">
        阅读 <span id="busuanzi_value_page_pv"></span>
      </li>
    </ul>
  </div>
  <div class="container">
    <div class="article">
      <div class="content">
        
        <h1 id="Node项目"><a href="#Node项目" class="headerlink" title="Node项目"></a>Node项目</h1><h2 id="1-项目功能"><a href="#1-项目功能" class="headerlink" title="1.  项目功能"></a>1.  项目功能</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.用户模块</span><br><span class="line">	用户登录</span><br><span class="line">	用户注册</span><br><span class="line">	用户退出</span><br><span class="line">2.文章</span><br><span class="line">	文章列表</span><br><span class="line">	文章详情</span><br><span class="line">		发布新文章</span><br><span class="line">		编辑文章</span><br><span class="line">		删除文章</span><br></pre></td></tr></table></figure>
<h2 id="2-项目准备-介绍"><a href="#2-项目准备-介绍" class="headerlink" title="2.  项目准备-介绍"></a>2.  项目准备-介绍</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">环境：Node.js + express</span><br><span class="line">数据库:mysql</span><br><span class="line">分布式管理工具:git</span><br><span class="line">实际开发中，先实现注册功能再实现登录功能,有账号才能登录</span><br><span class="line">git回顾</span><br><span class="line">	git init    目录下多一个.git文件</span><br><span class="line">	git status</span><br><span class="line">	git add .</span><br><span class="line">	git commit -m &quot;&quot;</span><br><span class="line">	新建仓库</span><br><span class="line">	关联仓库</span><br><span class="line">	git push -u origin master</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">项目准备</span><br><span class="line">1.创建文件夹 webkit</span><br><span class="line">	npm init -y  第一次使用需要初始化</span><br><span class="line">	npm i express</span><br><span class="line">2.git管理</span><br><span class="line">	git init</span><br><span class="line">	git status</span><br><span class="line">		node_modues:不需要上传到git</span><br><span class="line">		在目录下创建一个.gitignore文件,把不想要用git管理的文件或者文件夹的名字放在这个文件里面</span><br><span class="line">		.gitignore：/node_modules</span><br><span class="line">	git add .</span><br><span class="line">		创建远程仓库</span><br><span class="line">		github =&gt; + =&gt; new repository =&gt; 名字-public-creating =&gt; </span><br><span class="line">	git commit -m &quot;&quot;</span><br><span class="line">	git remote add origin 链接     关联仓库</span><br><span class="line">	git push -u origin master      第一次推送</span><br></pre></td></tr></table></figure>
<h2 id="3-项目文件组成"><a href="#3-项目文件组成" class="headerlink" title="3.  项目文件组成"></a>3.  项目文件组成</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">package.json</span><br><span class="line">package-lock.json</span><br><span class="line">.gitignore</span><br><span class="line">app.js  程序入口文件</span><br><span class="line">router.js 路由配置文件</span><br><span class="line">/fun/fun.js:控制器文件  实现具体功能函数</span><br><span class="line">/views:html文件</span><br><span class="line">/public:静态资源文件</span><br></pre></td></tr></table></figure>
<p>第一次:</p>
<p><code>app.js</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">原始代码</span><br><span class="line">// 1.导包</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">// 2.实例化</span><br><span class="line">const app = express();</span><br><span class="line">// 3.配置路由</span><br><span class="line">app.get(&apos;&apos;,(req,res) =&gt; &#123;</span><br><span class="line">	res.send(&apos;//////&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">// 4.监听端口</span><br><span class="line">app.listen(12345,() =&gt; &#123;</span><br><span class="line">	console.log(&apos;run it at localhost:12345&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>第二次:</p>
<p><code>app.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">优化代码,提取路由</span><br><span class="line">// 1.导包</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">// //配置路由1.1 导包</span><br><span class="line">const router = require(&apos;./router&apos;);</span><br><span class="line">// 2.实例化</span><br><span class="line">const app = express();</span><br><span class="line">// 3.配置路由</span><br><span class="line">// // //配置路由1.2 使用路由 实例化</span><br><span class="line">app.use(router);</span><br><span class="line">// 4.监听端口</span><br><span class="line">app.listen(12345,() =&gt; &#123;</span><br><span class="line">	console.log(&apos;run it at localhost:12345&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">文件作用:配置路由</span><br><span class="line">// 文件作用:配置路由</span><br><span class="line">// 1.导包</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">// 2.实例化</span><br><span class="line">const router = express.Router();</span><br><span class="line">// 3.配置路由</span><br><span class="line">// 参数1:标识  参数2：callback</span><br><span class="line">router.get(&apos;&apos;,(req,res) =&gt; &#123;</span><br><span class="line">	res.send(&apos;//////&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p>提取路由配置中函数处理部分代码,修改touter.js文件</p>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 文件作用:配置路由</span><br><span class="line">// 1.导包</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">// user.js导入模块</span><br><span class="line">const user = require(&apos;./fun/user&apos;);</span><br><span class="line">// 2.实例化</span><br><span class="line">const router = express.Router();</span><br><span class="line">// 3.配置路由</span><br><span class="line">// 参数1:标识  参数2：callback</span><br><span class="line">// user.js对象导出使用</span><br><span class="line">router.get(&apos;/&apos;,user.login);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>user.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 提取路由配置中函数处理部分代码</span><br><span class="line">exports.login = (req,res) =&gt; &#123;</span><br><span class="line">	res.send(&apos;//////&apos;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>git</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;初始化项目文件&quot;</span><br><span class="line">此时不需要push，只有大功能时才需要提交</span><br></pre></td></tr></table></figure>
<h2 id="4-登录功能拆分"><a href="#4-登录功能拆分" class="headerlink" title="4.  登录功能拆分"></a>4.  登录功能拆分</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.渲染登录页面</span><br><span class="line">2.客户端发送表单请求</span><br><span class="line">3.服务端处理客户端的请求,返回响应</span><br><span class="line">4.客户端处理服务端返回的响应</span><br></pre></td></tr></table></figure>
<h3 id="4-1-渲染登录页面"><a href="#4-1-渲染登录页面" class="headerlink" title="4.1  渲染登录页面"></a>4.1  渲染登录页面</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.导入登录页面的素材 </span><br><span class="line"> 	views:signin.html</span><br><span class="line"> 	public: css img</span><br><span class="line"> 2.配置第三方包</span><br><span class="line"> 3.统一处理静态资源文件</span><br><span class="line"> 4.增加路由配置+找方法</span><br><span class="line"> 5.渲染视图 res.render()</span><br></pre></td></tr></table></figure>
<h3 id="4-2-安装第三方包-配置静态资源"><a href="#4-2-安装第三方包-配置静态资源" class="headerlink" title="4.2  安装第三方包-配置静态资源"></a>4.2  安装第三方包-配置静态资源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.配置第三方包   安装包</span><br><span class="line">npm i jquery bootstrap@3.3.7</span><br><span class="line">包之间加空格,可以同时安装两个包</span><br><span class="line">2.统一处理第三方资源</span><br><span class="line">在app.js文件中配置</span><br><span class="line">app.use(&apos;/node_modules&apos;,express.static(&apos;/node_modules&apos;));</span><br><span class="line">app.use(&apos;/public&apos;,express.static(&apos;/public&apos;));</span><br></pre></td></tr></table></figure>
<h3 id="4-3-渲染登录页面-路由配置"><a href="#4-3-渲染登录页面-路由配置" class="headerlink" title="4.3  渲染登录页面-路由配置"></a>4.3  渲染登录页面-路由配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">当标识是signin的时候,渲染登录页面</span><br><span class="line">在配置路由页面中配置渲染登录页的代码</span><br><span class="line">1.安装express-art-template包</span><br><span class="line">	官网:https://www.npmjs.com/package/express-art-template</span><br><span class="line">	npm i art-template</span><br><span class="line">	npm i express-art-template</span><br><span class="line">2.导入包之后为res对象添加了一个render()方法</span><br><span class="line">3.在app.js中配置</span><br><span class="line">app.engine(&apos;html&apos;, require(&apos;express-art-template&apos;));</span><br><span class="line">4.在配置路由文件中渲染页面</span><br><span class="line">router.get(&apos;/&apos;,user.login);  当标识是/时，渲染页面</span><br><span class="line">5.在user.js文件中处理函数中的代码</span><br><span class="line">// 渲染登录页面</span><br><span class="line">exports.login = (req,res) =&gt; &#123;</span><br><span class="line">	res.render(&apos;signin.html&apos;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>模板引擎渲染页面参考代码</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.导包</span><br><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">2.实例化</span><br><span class="line">var app = express();</span><br><span class="line">3.配置   当请求的是html文件时</span><br><span class="line">app.engine(&apos;html&apos;, require(&apos;express-art-template&apos;));</span><br><span class="line">4.配置路由</span><br><span class="line">app.get(&apos;/&apos;, function (req, res) &#123;</span><br><span class="line">    res.render(&apos;signin.html&apos;, &#123;</span><br><span class="line">        user: &#123;</span><br><span class="line">            name: &apos;aui&apos;,</span><br><span class="line">            tags: [&apos;art&apos;, &apos;template&apos;, &apos;nodejs&apos;]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="4-4-客户端发送表单请求"><a href="#4-4-客户端发送表单请求" class="headerlink" title="4.4  客户端发送表单请求"></a>4.4  客户端发送表单请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ES6新语法：不是所有浏览器都支持</span><br><span class="line">1.找到表单文件</span><br><span class="line">2.取消表单默认行为</span><br><span class="line">3.获取表单数据</span><br><span class="line">4.ajax post</span><br></pre></td></tr></table></figure>
<p><code>signin.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        $(&apos;form&apos;).on(&apos;submit&apos;,function(e)&#123;</span><br><span class="line">            var data = $(this).serialize();</span><br><span class="line">            $.post(&apos;/signin&apos;,data,function(data)&#123;</span><br><span class="line">                console.log(data);</span><br><span class="line">            &#125;);</span><br><span class="line">            // 取消浏览器默认行为</span><br><span class="line">            // return false;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="4-5-服务端处理表单-获取表单数据"><a href="#4-5-服务端处理表单-获取表单数据" class="headerlink" title="4.5  服务端处理表单-获取表单数据"></a>4.5  服务端处理表单-获取表单数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">服务端</span><br><span class="line">	1.获取表单提交的数据</span><br><span class="line">	2.先验证邮箱</span><br><span class="line">	3.验证该邮箱的密码是否正确</span><br><span class="line">	4.返回200状态码</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在router.js文件中配置路由</span><br><span class="line">router.post(&apos;/signin&apos;,user.handleLogin);</span><br></pre></td></tr></table></figure>
<p><code>user.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exports.handleLogin = (req,res) =&gt; &#123;</span><br><span class="line">    // 获取表单提交的数据 body-parser</span><br><span class="line">    var body = req.body;</span><br><span class="line">    body: &#123; email: &apos;111@111.com&apos;, password: &apos;111&apos; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>body-parser包的使用</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.安装 npm i body-parser</span><br><span class="line">2.导包 const bodyParser = require(&apos;body-parser&apos;);</span><br><span class="line">3.配置</span><br><span class="line">	// 配置body-parser</span><br><span class="line">    app.use(bodyParser.urlencoded(&#123; extended: false &#125;));</span><br><span class="line">    app.use(bodyParser.json());</span><br><span class="line"> 4.结果就是为req对象添加了body属性，来获取表单数据</span><br><span class="line"> 	var body = req.body;</span><br><span class="line"> 	&#123; email: &apos;111@111.com&apos;, password: &apos;111&apos; &#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-6-服务端处理表单-验证邮箱"><a href="#4-6-服务端处理表单-验证邮箱" class="headerlink" title="4.6  服务端处理表单-验证邮箱"></a>4.6  服务端处理表单-验证邮箱</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">通过数据库来验证</span><br><span class="line">在user.js文件中</span><br><span class="line">// 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;message&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">// 渲染登录页面</span><br><span class="line">exports.login = (req,res) =&gt; &#123;</span><br><span class="line">	res.render(&apos;signin.html&apos;);</span><br><span class="line">&#125;;</span><br><span class="line">// 处理登陆页表单逻辑</span><br><span class="line">exports.handleLogin = (req,res) =&gt; &#123;</span><br><span class="line">	// 接收表单提交的数据  body-parser</span><br><span class="line">	const body = req.body;</span><br><span class="line">	// console.log(body);</span><br><span class="line">	const sqlStr = &apos;select * from `users` where email = ?&apos;;</span><br><span class="line">	connection.query(sqlStr,body.email,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			throw error;</span><br><span class="line">		&#125;</span><br><span class="line">		// console.log(results);</span><br><span class="line">		如果results的值  有数据，则返回对应的数据(数组)，没有数据则为空数组。</span><br><span class="line">		if(results.length === 0)&#123;</span><br><span class="line">            res.send(&#123;</span><br><span class="line">                code:1,</span><br><span class="line">                msg:&apos;邮箱不存在&apos;</span><br><span class="line">            &#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		//邮箱存在，验证邮箱密码是否正确</span><br><span class="line">		// 邮箱正确,results为查询到的数据</span><br><span class="line">		if(results[0].password !== body.password)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 2,</span><br><span class="line">				msg: &quot;密码不正确&quot;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		res.send(&#123;</span><br><span class="line">			code: 200,</span><br><span class="line">			msg: &apos;可以登录了&apos;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sql包使用</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1.安装 npm i mysql</span><br><span class="line">// 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;message&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">// 4.执行sql语句</span><br><span class="line">const id = 257;</span><br><span class="line">const sqlStr = &apos;delete from `posts` where id = ?&apos;;</span><br><span class="line">connection.query(sqlStr,[id],(error,results) =&gt; &#123;</span><br><span class="line">	console.log(results);</span><br><span class="line">&#125;);</span><br><span class="line">// 5.关闭数据库连接</span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
<h3 id="4-7-服务端处理表单-验证密码-返回响应"><a href="#4-7-服务端处理表单-验证密码-返回响应" class="headerlink" title="4.7  服务端处理表单-验证密码-返回响应"></a>4.7  服务端处理表单-验证密码-返回响应</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">user.js</span><br><span class="line">//邮箱存在，验证邮箱密码是否正确</span><br><span class="line">// 邮箱正确,results为查询到的数据</span><br><span class="line">if(results[0].password !== body.password)&#123;</span><br><span class="line">    return res.send(&#123;</span><br><span class="line">        code: 2,</span><br><span class="line">        msg: &quot;密码不正确&quot;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">res.send(&#123;</span><br><span class="line">    code: 200,</span><br><span class="line">    msg: &apos;可以登录了&apos;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="4-8-客户端处理服务端返回的响应"><a href="#4-8-客户端处理服务端返回的响应" class="headerlink" title="4.8  客户端处理服务端返回的响应"></a>4.8  客户端处理服务端返回的响应</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.如果服务端返回的结果为200,邮箱密码都正确，客户端重定向到列表页</span><br><span class="line">2.如果不等于200,提示用户错误信息</span><br></pre></td></tr></table></figure>
<p><code>signin.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(&apos;form&apos;).on(&apos;submit&apos;,function(e)&#123;</span><br><span class="line">        var data = $(this).serialize();</span><br><span class="line">        $.post(&apos;/signin&apos;,data,function(data)&#123;</span><br><span class="line">            // console.log(data);</span><br><span class="line">            if(data.code == 200)&#123;</span><br><span class="line">           		window.location.href = &apos;/&apos;;</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">            	alert(data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        // 取消浏览器默认行为</span><br><span class="line">        // return false;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="4-9-登录优化-提取mysql模块"><a href="#4-9-登录优化-提取mysql模块" class="headerlink" title="4.9  登录优化-提取mysql模块"></a>4.9  登录优化-提取mysql模块</h3><p><code>fun/user.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// 导入数据库封装文件</span><br><span class="line">const mysql = require(&apos;../sql/user_login&apos;);</span><br><span class="line">// 渲染登录页面</span><br><span class="line">exports.login = (req,res) =&gt; &#123;</span><br><span class="line">	res.render(&apos;signin.html&apos;);</span><br><span class="line">&#125;;</span><br><span class="line">// 处理登陆页表单逻辑</span><br><span class="line">exports.handleLogin = (req,res) =&gt; &#123;</span><br><span class="line">	// 接收表单提交的数据  body-parser</span><br><span class="line">	const body = req.body;</span><br><span class="line">	// console.log(body);</span><br><span class="line">	mysql.checkForm(body.email, (error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			throw error;</span><br><span class="line">		&#125;</span><br><span class="line">		// console.log(results);  如果数据存在，则返回的数据数组不为0,否则数组长度为0</span><br><span class="line">		if(results.length === 0)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 1,</span><br><span class="line">				msg: &quot;邮箱不存在&quot;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		// 邮箱正确,results为查询到的数据</span><br><span class="line">		if(results[0].password !== body.password)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 2,</span><br><span class="line">				msg: &quot;密码不正确&quot;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		res.send(&#123;</span><br><span class="line">			code: 200,</span><br><span class="line">			msg: &apos;可以登录了&apos;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>封装的sql/user_login.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">//专门处理数据库操作的代码并且返回执行的结果</span><br><span class="line">// 提取路由配置中函数处理部分代码</span><br><span class="line">//mysql // 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;webkit&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">exports.checkForm = (email,callback) =&gt; &#123;</span><br><span class="line">	const sqlStr = &apos;select * from `users` where email = ?&apos;;</span><br><span class="line">	connection.query(sqlStr,email,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return callback(error);</span><br><span class="line">		&#125;</span><br><span class="line">		callback(null,results);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>扩展</p>
<p><code>将mysql配置前三步提取到一个文件中 db_config.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//mysql // 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;webkit&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">module.exports = connection;</span><br></pre></td></tr></table></figure>
<p><code>sql/user_login.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">导入db_config.js包</span><br><span class="line">const connection = require(../mysql/db_config);</span><br><span class="line">exports.checkForm = (email,callback) =&gt; &#123;</span><br><span class="line">	const sqlStr = &apos;select * from `users` where email = ?&apos;;</span><br><span class="line">	connection.query(sqlStr,email,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return callback(error);</span><br><span class="line">		&#125;</span><br><span class="line">		callback(null,results);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-项目-MVC-各司其职"><a href="#5-项目-MVC-各司其职" class="headerlink" title="5.  项目-MVC-各司其职"></a>5.  项目-MVC-各司其职</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view：视图 html文件+css+js+模板引擎</span><br><span class="line">model:操作数据库</span><br><span class="line">controls：函数处理逻辑  实现大量业务逻辑</span><br></pre></td></tr></table></figure>
<h2 id="6-文章列表"><a href="#6-文章列表" class="headerlink" title="6.  文章列表"></a>6.  文章列表</h2><h3 id="6-1-渲染列表页"><a href="#6-1-渲染列表页" class="headerlink" title="6.1  渲染列表页"></a>6.1  渲染列表页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.当请求标识为&apos;/&apos;时，发起对列表页的渲染</span><br><span class="line">2.增加router请求,实现渲染列表的函数代码</span><br><span class="line">3.topList.js 实现函数代码 渲染页面</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 文件作用:配置路由</span><br><span class="line">// 1.导包</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">// user.js导入模块</span><br><span class="line">const user = require(&apos;./fun/user&apos;);</span><br><span class="line">// topList.js 文章列表</span><br><span class="line">const topList = require(&apos;./fun/topList.js&apos;);</span><br><span class="line">// 2.实例化</span><br><span class="line">const router = express.Router();</span><br><span class="line">// 3.配置路由</span><br><span class="line">// 参数1:标识  参数2：callback</span><br><span class="line">// user.js对象导出使用</span><br><span class="line">	  //渲染登录页面</span><br><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	  //处理登录页面表单逻辑</span><br><span class="line">	  .post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	  //渲染列表页面</span><br><span class="line">	  .get(&apos;/&apos;,topList.list);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 渲染文章列表</span><br><span class="line">exports.list = (req,res) =&gt; &#123;</span><br><span class="line">	res.render(&apos;index.html&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-2-数据处理"><a href="#6-2-数据处理" class="headerlink" title="6.2  数据处理"></a>6.2  数据处理</h3><p><code>topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const topList = require(&apos;../sql/topic_list.js&apos;);</span><br><span class="line">// 渲染文章列表</span><br><span class="line">exports.list = (req,res) =&gt; &#123;</span><br><span class="line">	// 通过mysql获取列表数据</span><br><span class="line">	topList.showList((error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code:500,</span><br><span class="line">				msg: &apos;服务器错啦&apos;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		res.render(&apos;index.html&apos;,&#123;</span><br><span class="line">			items: results</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>toppic_list.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//mysql // 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;webkit&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">exports.showList = (callback) =&gt; &#123;</span><br><span class="line">	const sqlStr = &apos;select * from `topics` order by id desc&apos;;</span><br><span class="line">	connection.query(sqlStr,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			callback(error);</span><br><span class="line">		&#125;</span><br><span class="line">		callback(null,results);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>index.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul class=&quot;media-list&quot;&gt;</span><br><span class="line">     &#123;&#123;each items&#125;&#125;</span><br><span class="line">           &lt;li class=&quot;media&quot;&gt;</span><br><span class="line">               &lt;div class=&quot;media-left&quot;&gt;</span><br><span class="line">                   &lt;a href=&quot;/&quot;&gt;</span><br><span class="line">                        &lt;img width=&quot;40&quot; height=&quot;40&quot; class=&quot;media-object&quot; src=&quot;../public/img/avatar-max-img.png&quot; alt=&quot;...&quot;&gt;</span><br><span class="line">                   &lt;/a&gt;</span><br><span class="line">               &lt;/div&gt;</span><br><span class="line">               &lt;div class=&quot;media-body&quot;&gt;</span><br><span class="line">                   &lt;h4 class=&quot;media-heading&quot;&gt;&lt;a href=&quot;&quot;&gt;&#123;&#123;$value.title&#125;&#125;&lt;/a&gt;&lt;/h4&gt;</span><br><span class="line">                   &lt;p&gt;sueysok 回复了问题 • 2 人关注 • 1 个回复 • 187 次浏览 • 话题创建时间&lt;/p&gt;</span><br><span class="line">               &lt;/div&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">      &#123;&#123;/each&#125;&#125;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<h3 id="6-3-express-session-保存用户信息"><a href="#6-3-express-session-保存用户信息" class="headerlink" title="6.3  express-session-保存用户信息"></a>6.3  express-session-保存用户信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.安装</span><br><span class="line">	npm install express-session</span><br><span class="line">2.导包</span><br><span class="line">	const session = require(&apos;express-session&apos;);</span><br><span class="line">3.配置</span><br><span class="line">	var app = express();</span><br><span class="line">	app.use(session(&#123;</span><br><span class="line">      secret: &apos;keyboard cat&apos;,</span><br><span class="line">      resave: false,</span><br><span class="line">      saveUninitialized: true</span><br><span class="line">    &#125;));</span><br><span class="line">    让req请求对象添加一个session属性</span><br><span class="line">4.session</span><br><span class="line">	req.session.user = data[0];</span><br></pre></td></tr></table></figure>
<p><code>user.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// 导入数据库封装文件</span><br><span class="line">const mysql = require(&apos;../sql/user_login&apos;);</span><br><span class="line">// 渲染登录页面</span><br><span class="line">exports.login = (req,res) =&gt; &#123;</span><br><span class="line">	res.render(&apos;signin.html&apos;);</span><br><span class="line">&#125;;</span><br><span class="line">// 处理登陆页表单逻辑</span><br><span class="line">exports.handleLogin = (req,res) =&gt; &#123;</span><br><span class="line">	// 接收表单提交的数据  body-parser</span><br><span class="line">	const body = req.body;</span><br><span class="line">	// console.log(body);</span><br><span class="line">	mysql.checkForm(body.email, (error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			throw error;</span><br><span class="line">		&#125;</span><br><span class="line">		// console.log(results);  如果数据存在，则返回的数据数组不为0,否则数组长度为0</span><br><span class="line">		if(results.length === 0)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 1,</span><br><span class="line">				msg: &quot;邮箱不存在&quot;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		// 邮箱正确,results为查询到的数据</span><br><span class="line">		if(results[0].password !== body.password)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 2,</span><br><span class="line">				msg: &quot;密码不正确&quot;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		req.session.user = results[0];</span><br><span class="line">		console.log(req.session.user);</span><br><span class="line">		res.send(&#123;</span><br><span class="line">			code: 200,</span><br><span class="line">			msg: &apos;可以登录了&apos;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-4-登录和注册的显示与隐藏"><a href="#6-4-登录和注册的显示与隐藏" class="headerlink" title="6.4  登录和注册的显示与隐藏"></a>6.4  登录和注册的显示与隐藏</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在列表页的头部部分判断session存在与否</span><br></pre></td></tr></table></figure>
<p><code>topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const topList = require(&apos;../sql/topic_list.js&apos;);</span><br><span class="line">// 渲染文章列表</span><br><span class="line">exports.list = (req,res) =&gt; &#123;</span><br><span class="line">	// 通过mysql获取列表数据</span><br><span class="line">	topList.showList((error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code:500,</span><br><span class="line">				msg: &apos;服务器错啦&apos;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		res.render(&apos;index.html&apos;,&#123;</span><br><span class="line">			items: results,</span><br><span class="line">			user: req.session.user</span><br><span class="line">			// 将保存在session中的数据取出来渲染在列表页</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>header.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">判断session中的数据，如果存在就显示。。如果不存在显示登陆注册按钮</span><br><span class="line">&lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt;</span><br><span class="line">    &#123;&#123;if user&#125;&#125;</span><br><span class="line">        &lt;a class=&quot;btn btn-default navbar-btn&quot; href=&quot;/topic/create&quot;&gt;发起&lt;/a&gt;</span><br><span class="line">        &lt;li class=&quot;dropdown&quot;&gt;</span><br><span class="line">            &lt;a href=&quot;#&quot; class=&quot;dropdown-toggle&quot; data-toggle=&quot;dropdown&quot; role=&quot;button&quot; aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt;&lt;img width=&quot;20&quot; height=&quot;20&quot; src=&quot;../public/img/avatar-max-img.png&quot; alt=&quot;&quot;&gt; &lt;span class=&quot;caret&quot;&gt;&lt;/span&gt;&lt;/a&gt;</span><br><span class="line">            &lt;ul class=&quot;dropdown-menu&quot;&gt;</span><br><span class="line">                &lt;li class=&quot;dropdown-current-user&quot;&gt;</span><br><span class="line">                当前登录用户:爱谁谁</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li role=&quot;separator&quot; class=&quot;divider&quot;&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;a href=&quot;#&quot;&gt;个人主页&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;a href=&quot;/settings/profile&quot;&gt;设置&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;a href=&quot;/signout&quot;&gt;退出&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    &#123;&#123;else&#125;&#125;</span><br><span class="line">        &lt;a class=&quot;btn btn-primary navbar-btn&quot; href=&quot;/login&quot;&gt;登录&lt;/a&gt;</span><br><span class="line">        &lt;a class=&quot;btn btn-success navbar-btn&quot; href=&quot;/signup&quot;&gt;注册&lt;/a&gt;</span><br><span class="line">    &#123;&#123;/if&#125;&#125;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<h3 id="6-5-显示当前用户名"><a href="#6-5-显示当前用户名" class="headerlink" title="6.5  显示当前用户名"></a>6.5  显示当前用户名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">将user中的数据渲染出来</span><br><span class="line">当前登录用户:&#123;&#123;user.nickname&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-发布新文章"><a href="#7-发布新文章" class="headerlink" title="7.发布新文章"></a>7.发布新文章</h2><h3 id="7-1-渲染页面"><a href="#7-1-渲染页面" class="headerlink" title="7.1  渲染页面"></a>7.1  渲染页面</h3><p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 文件作用:配置路由</span><br><span class="line">// 1.导包</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">// user.js导入模块</span><br><span class="line">const user = require(&apos;./fun/user&apos;);</span><br><span class="line">// topList.js 文章列表</span><br><span class="line">const topic = require(&apos;./fun/topList.js&apos;);</span><br><span class="line">// 2.实例化</span><br><span class="line">const router = express.Router();</span><br><span class="line">// 3.配置路由</span><br><span class="line">// 参数1:标识  参数2：callback</span><br><span class="line">// user.js对象导出使用</span><br><span class="line">// //渲染登录页面</span><br><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 添加话题</span><br><span class="line">exports.createTopic = (req,res) =&gt; &#123;</span><br><span class="line">	res.render(&apos;topic/create.html&apos;,&#123;</span><br><span class="line">        user: req.session.user</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-2-客户端发送表单请求"><a href="#7-2-客户端发送表单请求" class="headerlink" title="7.2  客户端发送表单请求"></a>7.2  客户端发送表单请求</h3><p><code>create.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;form id=&quot;form&quot; action=&apos;/topic/create&apos;&gt;</span><br><span class="line">    &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">        &lt;label for=&quot;title&quot;&gt;标题&lt;/label&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;title&quot; name=&quot;title&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">        &lt;label for=&quot;content&quot;&gt;内容&lt;/label&gt;</span><br><span class="line">        &lt;textarea class=&quot;form-control&quot; id=&quot;content&quot; name=&quot;content&quot; rows=&quot;10&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;提交&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">       $(&apos;#form&apos;).on(&apos;submit&apos;,function(e)&#123;</span><br><span class="line">            var dataForm = $(this).serialize();</span><br><span class="line">            $.post(&apos;/topic/create&apos;,dataForm,function(data)&#123;</span><br><span class="line">                console.log(data);</span><br><span class="line">            &#125;);</span><br><span class="line">            //阻止浏览器默认提交</span><br><span class="line">            e.preventDefault();</span><br><span class="line">       &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="7-3-服务端处理表单请求"><a href="#7-3-服务端处理表单请求" class="headerlink" title="7.3  服务端处理表单请求"></a>7.3  服务端处理表单请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.router.js  当请求标识为/topic/create</span><br><span class="line">2.topList.js  接收数据,往数据库中添加数据</span><br><span class="line">3.createTopicHandle.js  封装处理数据库函数</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 文件作用:配置路由</span><br><span class="line">// 1.导包</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">// user.js导入模块</span><br><span class="line">const user = require(&apos;./fun/user&apos;);</span><br><span class="line">// topList.js 文章列表</span><br><span class="line">const topic = require(&apos;./fun/topList.js&apos;);</span><br><span class="line">// 2.实例化</span><br><span class="line">const router = express.Router();</span><br><span class="line">// 3.配置路由</span><br><span class="line">// 参数1:标识  参数2：callback</span><br><span class="line">// user.js对象导出使用</span><br><span class="line">// //渲染登录页面</span><br><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic)</span><br><span class="line">	.post(&apos;/topic/create&apos;,topic.createTopicHandle);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>fun/topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 处理文章表单逻辑</span><br><span class="line">exports.createTopicHandle = (req,res) =&gt; &#123;</span><br><span class="line">	const data = req.body;</span><br><span class="line">	createTopicHandl.createHandle(data, (error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">                code: 500,</span><br><span class="line">                msg: &quot;服务器出错了&quot;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		res.send(&#123;</span><br><span class="line">            code: 200,</span><br><span class="line">            msg: &quot;话题发布成功&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>createTopicHandle.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//mysql // 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;webkit&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">exports.createHandle = (data,callback) =&gt; &#123;</span><br><span class="line">	const sqlStr = &apos;insert into `topics` set ?&apos;;</span><br><span class="line">	connection.query(sqlStr,data,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			callback(error);</span><br><span class="line">		&#125;</span><br><span class="line">		callback(null,results);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-4-客户端处理服务端返回的数据"><a href="#7-4-客户端处理服务端返回的数据" class="headerlink" title="7.4  客户端处理服务端返回的数据"></a>7.4  客户端处理服务端返回的数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">      $(&apos;#form&apos;).on(&apos;submit&apos;,function(e)&#123;</span><br><span class="line">            var dataForm = $(this).serialize();</span><br><span class="line">            $.post(&apos;/topic/create&apos;,dataForm,function(data)&#123;</span><br><span class="line">                // console.log(data);</span><br><span class="line">                if(data.code == 200)&#123;</span><br><span class="line">                    window.location.href = &apos;/&apos;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            e.preventDefault();</span><br><span class="line">      &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="8-持久化存储用户信息"><a href="#8-持久化存储用户信息" class="headerlink" title="8.  持久化存储用户信息"></a>8.  持久化存储用户信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.express-session:存的数据在服务器的内存中 每次重启服务器数据就会消失  req.session  持久化存储  -mysql或者本地存储</span><br><span class="line">2.express-mysql-session</span><br><span class="line">作用:把express-session保存的数据req.session自动的保存到数据库中</span><br><span class="line">1)安装 npm i express-mysql-session</span><br><span class="line">2)app.js文件中配置包</span><br><span class="line">3)express-session包也需要导入</span><br><span class="line">4)结果 当使用req.session.user = ？ 时,会自动把数据放在mysql中</span><br><span class="line">5)结果 当访问req.session.user时,会自动查询数据库</span><br></pre></td></tr></table></figure>
<p><code>app.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// 1.导入express-mysql-session</span><br><span class="line">const session = require(&apos;express-session&apos;);</span><br><span class="line">const MySQLStore = require(&apos;express-mysql-session&apos;)(session);</span><br><span class="line">// 2.配置express-mysql-session</span><br><span class="line">const options = &#123;</span><br><span class="line">    host: &apos;localhost&apos;,</span><br><span class="line">    port: 3306,</span><br><span class="line">    user: &apos;root&apos;,</span><br><span class="line">    password: &apos;root&apos;,</span><br><span class="line">    database: &apos;webkit&apos;</span><br><span class="line">&#125;;</span><br><span class="line">// 3.实例化express-mysql-session</span><br><span class="line">const sessionStore = new MySQLStore(options);</span><br><span class="line">//4.</span><br><span class="line">app.use(session(&#123;</span><br><span class="line">    key: &apos;session_cookie_name&apos;,</span><br><span class="line">    secret: &apos;session_cookie_secret&apos;,</span><br><span class="line">    store: sessionStore,</span><br><span class="line">    resave: false,</span><br><span class="line">    saveUninitialized: false</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<h3 id="8-1-设置话题的createdAt"><a href="#8-1-设置话题的createdAt" class="headerlink" title="8.1  设置话题的createdAt"></a>8.1  设置话题的createdAt</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">自动格式化时间  momentjs.com</span><br><span class="line">1.安装包 npm i moment</span><br><span class="line">2.导包  const moment = require(&apos;moment&apos;);</span><br><span class="line">3.使用</span><br><span class="line">	在文章表单提交的时候,服务器端获取表单数据,动态的添加数据 createAt 创建时间日期</span><br><span class="line">	body.createdAt = moment().format();</span><br></pre></td></tr></table></figure>
<h3 id="8-2-设置话题的创建者-userId"><a href="#8-2-设置话题的创建者-userId" class="headerlink" title="8.2  设置话题的创建者-userId"></a>8.2  设置话题的创建者-userId</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">把当前存的用户id值 赋值给文章里面的userId</span><br><span class="line">区分每个文章的创建者</span><br><span class="line">body.userId = req.session.user.id;</span><br></pre></td></tr></table></figure>
<h2 id="9-退出用户"><a href="#9-退出用户" class="headerlink" title="9. 退出用户"></a>9. 退出用户</h2><h3 id="9-1-退出用户"><a href="#9-1-退出用户" class="headerlink" title="9.1  退出用户"></a>9.1  退出用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete xxx:js自带方法,删除对象成员</span><br><span class="line">点击退出：删除session 退回到登陆页</span><br></pre></td></tr></table></figure>
<p><code>header.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul class=&quot;dropdown-menu&quot;&gt;</span><br><span class="line">    &lt;li class=&quot;dropdown-current-user&quot;&gt;</span><br><span class="line">        当前登录用户:&#123;&#123;user.nickname&#125;&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li role=&quot;separator&quot; class=&quot;divider&quot;&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href=&quot;#&quot;&gt;个人主页&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href=&quot;/settings/profile&quot;&gt;设置&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href=&quot;/signout&quot;&gt;退出&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// 文件作用:配置路由</span><br><span class="line">// 1.导包</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">// user.js导入模块</span><br><span class="line">const user = require(&apos;./fun/user&apos;);</span><br><span class="line">// topList.js 文章列表</span><br><span class="line">const topic = require(&apos;./fun/topList.js&apos;);</span><br><span class="line">// 2.实例化</span><br><span class="line">const router = express.Router();</span><br><span class="line">// 3.配置路由</span><br><span class="line">// 参数1:标识  参数2：callback</span><br><span class="line">// user.js对象导出使用</span><br><span class="line">// //渲染登录页面</span><br><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic)</span><br><span class="line">	.post(&apos;/topic/create&apos;,topic.createTopicHandle)</span><br><span class="line">	.get(&apos;/signout&apos;,user.signout);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>fun/user.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">// 导入数据库封装文件</span><br><span class="line">const mysql = require(&apos;../sql/user_login&apos;);</span><br><span class="line">// 渲染登录页面</span><br><span class="line">exports.login = (req,res) =&gt; &#123;</span><br><span class="line">	res.render(&apos;signin.html&apos;);</span><br><span class="line">&#125;;</span><br><span class="line">// 处理登陆页表单逻辑</span><br><span class="line">exports.handleLogin = (req,res) =&gt; &#123;</span><br><span class="line">	// 接收表单提交的数据  body-parser</span><br><span class="line">	const body = req.body;</span><br><span class="line">	// console.log(body);</span><br><span class="line">	mysql.checkForm(body.email, (error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			throw error;</span><br><span class="line">		&#125;</span><br><span class="line">		// console.log(results);  如果数据存在，则返回的数据数组不为0,否则数组长度为0</span><br><span class="line">		if(results.length === 0)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 1,</span><br><span class="line">				msg: &quot;邮箱不存在&quot;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		// 邮箱正确,results为查询到的数据</span><br><span class="line">		if(results[0].password !== body.password)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 2,</span><br><span class="line">				msg: &quot;密码不正确&quot;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		// 将用户信息存在session中</span><br><span class="line">		req.session.user = results[0];</span><br><span class="line">		// console.log(req.session.user);</span><br><span class="line">		res.send(&#123;</span><br><span class="line">			code: 200,</span><br><span class="line">			msg: &apos;可以登录了&apos;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line">// 退出登陆页处理</span><br><span class="line">exports.signout = (req,res) =&gt; &#123;</span><br><span class="line">	// 删除session</span><br><span class="line">	delete req.session.user;</span><br><span class="line">	// 退出到登陆页</span><br><span class="line">	res.redirect(&apos;/login&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-文章详情"><a href="#10-文章详情" class="headerlink" title="10.  文章详情"></a>10.  文章详情</h2><h3 id="10-1-渲染页面"><a href="#10-1-渲染页面" class="headerlink" title="10.1  渲染页面"></a>10.1  渲染页面</h3><p><code>index.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul class=&quot;media-list&quot;&gt;</span><br><span class="line">    &#123;&#123;each items&#125;&#125;</span><br><span class="line">        &lt;li class=&quot;media&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;media-left&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;/&quot;&gt;</span><br><span class="line">                &lt;img width=&quot;40&quot; height=&quot;40&quot; class=&quot;media-object&quot; src=&quot;../public/img/avatar-max-img.png&quot; alt=&quot;...&quot;&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;media-body&quot;&gt;</span><br><span class="line">                &lt;h4 class=&quot;media-heading&quot;&gt;&lt;a href=&quot;/detail/topic&quot;&gt;&#123;&#123;$value.title&#125;&#125;&lt;/a&gt;&lt;/h4&gt;</span><br><span class="line">                &lt;p&gt;sueysok 回复了问题 • 2 人关注 • 1 个回复 • 187 次浏览 • 话题创建时间</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic)</span><br><span class="line">	.post(&apos;/topic/create&apos;,topic.createTopicHandle)</span><br><span class="line">	.get(&apos;/signout&apos;,user.signout)</span><br><span class="line">	.get(&apos;/detail/topic&apos;,topic.detail);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 话题详情页</span><br><span class="line">exports.detail = (req,res) =&gt; &#123;</span><br><span class="line">	res.render(&apos;topic/show.html&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-2-配置路由–标识是动态的"><a href="#10-2-配置路由–标识是动态的" class="headerlink" title="10.2  配置路由–标识是动态的"></a>10.2  配置路由–标识是动态的</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/detail/topic/:topicID:如果标识是动态的，动态变化的部分用 :+形参表示</span><br></pre></td></tr></table></figure>
<p><code>index.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h4 class=&quot;media-heading&quot;&gt;&lt;a href=&quot;/detail/topic/&#123;&#123;$value.id&#125;&#125;&quot;&gt;&#123;&#123;$value.title&#125;&#125;&lt;/a&gt;&lt;/h4&gt;</span><br><span class="line">给每个标识后面添加动态的id,方便详情页通过id查询数据</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 3.配置路由</span><br><span class="line">// 参数1:标识  参数2：callback</span><br><span class="line">// user.js对象导出使用</span><br><span class="line">// //渲染登录页面</span><br><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic)</span><br><span class="line">	.post(&apos;/topic/create&apos;,topic.createTopicHandle)</span><br><span class="line">	.get(&apos;/signout&apos;,user.signout)</span><br><span class="line">	// /detail/topic/:topicID:如果标识是动态的，动态变化的部分用 :+形参表示</span><br><span class="line">	.get(&apos;/detail/topic/:topicID&apos;,topic.detail);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 话题详情页</span><br><span class="line">标识:.get(&apos;/detail/topic/:topicID&apos;,topic.detail);</span><br><span class="line">exports.detail = (req,res) =&gt; &#123;</span><br><span class="line">	// 获取标识动态路由参数的值   :冒号后面的</span><br><span class="line">	req.params   &#123;topicID:9&#125;</span><br><span class="line">	const topicID = req.params.topicID;</span><br><span class="line">	console.log(topicID);   </span><br><span class="line">	// res.render(&apos;topic/show.html&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-3-处理数据"><a href="#10-3-处理数据" class="headerlink" title="10.3  处理数据"></a>10.3  处理数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.在router.js文件中配置路由</span><br><span class="line">2.在fun/topList.js文件中  处理详情页逻辑业务</span><br><span class="line">3.在sql/detail.js文件中 处理 数据库查询代码</span><br><span class="line">4.在fun/topList.js文件中渲染页面数据</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 3.配置路由</span><br><span class="line">// 参数1:标识  参数2：callback</span><br><span class="line">// user.js对象导出使用</span><br><span class="line">// //渲染登录页面</span><br><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic)</span><br><span class="line">	.post(&apos;/topic/create&apos;,topic.createTopicHandle)</span><br><span class="line">	.get(&apos;/signout&apos;,user.signout)</span><br><span class="line">	// /detail/topic/:topicID:如果标识是动态的，动态变化的部分用 :+形参表示</span><br><span class="line">	.get(&apos;/detail/topic/:topicID&apos;,topic.topicDetail);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>fun/topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 话题详情页</span><br><span class="line">exports.topicDetail = (req,res) =&gt; &#123;</span><br><span class="line">	// 获取标识动态参数的值</span><br><span class="line">	const topicID = req.params.topicID;</span><br><span class="line">	detailData.detail(topicID,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code:500,</span><br><span class="line">				msg:&apos;服务器出错了&apos;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		if(results.length == 0)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 1,</span><br><span class="line">				msg:&apos;数据已经被删除&apos;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		res.render(&apos;topic/show.html&apos;,&#123;</span><br><span class="line">			topic: results[0]</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>detail.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//mysql // 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;webkit&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">exports.detail = (id,callback) =&gt; &#123;</span><br><span class="line">	const sqlStr = &apos;select * from `topics` where id = ?&apos;;</span><br><span class="line">	connection.query(sqlStr,id,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			callback(error);</span><br><span class="line">		&#125;</span><br><span class="line">		callback(null,results);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-4-处理数据不存在的情况"><a href="#10-4-处理数据不存在的情况" class="headerlink" title="10.4  处理数据不存在的情况"></a>10.4  处理数据不存在的情况</h3><p><code>show.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;col-md-9&quot;&gt;</span><br><span class="line">    &#123;&#123;if !topic&#125;&#125;</span><br><span class="line">        &lt;p&gt;此话题不存在或已被删除。&lt;/p&gt;</span><br><span class="line">        &lt;a class=&quot;btn btn-success&quot; href=&quot;/&quot;&gt;返回首页&lt;/a&gt;</span><br><span class="line">    &#123;&#123;else&#125;&#125;</span><br><span class="line">        &lt;article class=&quot;markdown-body&quot;&gt;</span><br><span class="line">            &lt;h1&gt;&#123;&#123;topic.title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">            &lt;a href=&quot;/topic/detail/edit&quot;&gt;编辑&lt;/a&gt;</span><br><span class="line">            &lt;a href=&quot;/topic/detail/delete&quot; id=&quot;delete_topic&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">            &lt;hr&gt; &#123;&#123;topic.content&#125;&#125;</span><br><span class="line">        &lt;/article&gt;</span><br><span class="line">        &lt;div class=&quot;panel panel-default&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;panel-heading&quot;&gt;</span><br><span class="line">                &lt;span&gt;lzz&lt;/span&gt; commented</span><br><span class="line">                &lt;span&gt;24 minutes ago&lt;/span&gt;</span><br><span class="line">                &lt;span class=&quot;action&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;&quot;&gt;&lt;i class=&quot;glyphicon glyphicon-thumbs-up pull-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;&quot;&gt;&lt;i class=&quot;glyphicon glyphicon-remove-circle pull-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;&quot;&gt;&lt;i class=&quot;glyphicon glyphicon-remove-circle pull-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;panel-body&quot;&gt;</span><br><span class="line">                评论测试</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;hr&gt;</span><br><span class="line">        &lt;form&gt;</span><br><span class="line">            &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">                &lt;label for=&quot;exampleInputPassword1&quot;&gt;添加回复&lt;/label&gt;</span><br><span class="line">                &lt;textarea class=&quot;form-control&quot; name=&quot;&quot; id=&quot;&quot; cols=&quot;10&quot; rows=&quot;10&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;回复&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &#123;&#123;/if&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="10-5-编辑与删除按钮的显示与隐藏"><a href="#10-5-编辑与删除按钮的显示与隐藏" class="headerlink" title="10.5  编辑与删除按钮的显示与隐藏"></a>10.5  编辑与删除按钮的显示与隐藏</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果文章的用户Id与session中的id一样，则显示编辑与删除按钮，否则隐藏。</span><br><span class="line">将session中的数据保存在数组中,在显示页面判断显示与隐藏</span><br></pre></td></tr></table></figure>
<p><code>topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// 话题详情页</span><br><span class="line">exports.topicDetail = (req,res) =&gt; &#123;</span><br><span class="line">	// 获取标识动态参数的值</span><br><span class="line">	const topicID = req.params.topicID;</span><br><span class="line">	detailData.detail(topicID,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code:500,</span><br><span class="line">				msg:&apos;服务器出错了&apos;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		// if(results.length == 0)&#123;</span><br><span class="line">		// 	return res.send(&#123;</span><br><span class="line">		// 		code: 1,</span><br><span class="line">		// 		msg:&apos;数据已经被删除&apos;</span><br><span class="line">		// 	&#125;);</span><br><span class="line">		// &#125;</span><br><span class="line">		res.render(&apos;topic/show.html&apos;,&#123;</span><br><span class="line">			topic: results[0],</span><br><span class="line">			userId: req.session.user ? req.session.user.id : 0</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>show.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;col-md-9&quot;&gt;</span><br><span class="line">    &#123;&#123;if !topic&#125;&#125;</span><br><span class="line">        &lt;p&gt;此话题不存在或已被删除。&lt;/p&gt;</span><br><span class="line">        &lt;a class=&quot;btn btn-success&quot; href=&quot;/&quot;&gt;返回首页&lt;/a&gt;</span><br><span class="line">    &#123;&#123;else&#125;&#125;</span><br><span class="line">        &lt;article class=&quot;markdown-body&quot;&gt;</span><br><span class="line">            &lt;h1&gt;&#123;&#123;topic.title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">            &#123;&#123;if topic.userId === userId&#125;&#125;</span><br><span class="line">            &lt;a href=&quot;/topic/detail/edit&quot;&gt;编辑&lt;/a&gt;</span><br><span class="line">            &lt;a href=&quot;/topic/detail/delete&quot; id=&quot;delete_topic&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">            &#123;&#123;/if&#125;&#125;</span><br><span class="line">            &lt;hr&gt; &#123;&#123;topic.content&#125;&#125;</span><br><span class="line">        &lt;/article&gt;</span><br><span class="line">        &lt;div class=&quot;panel panel-default&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;panel-heading&quot;&gt;</span><br><span class="line">                &lt;span&gt;lzz&lt;/span&gt; commented</span><br><span class="line">                &lt;span&gt;24 minutes ago&lt;/span&gt;</span><br><span class="line">                &lt;span class=&quot;action&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;&quot;&gt;&lt;i class=&quot;glyphicon glyphicon-thumbs-up pull-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;&quot;&gt;&lt;i class=&quot;glyphicon glyphicon-remove-circle pull-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;&quot;&gt;&lt;i class=&quot;glyphicon glyphicon-remove-circle pull-right&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;panel-body&quot;&gt;</span><br><span class="line">                评论测试</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;hr&gt;</span><br><span class="line">        &lt;form&gt;</span><br><span class="line">            &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;exampleInputPassword1&quot;&gt;添加回复&lt;/label&gt;</span><br><span class="line">            &lt;textarea class=&quot;form-control&quot; name=&quot;&quot; id=&quot;&quot; cols=&quot;10&quot; rows=&quot;10&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;回复&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &#123;&#123;/if&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h3 id="10-6-删除话题"><a href="#10-6-删除话题" class="headerlink" title="10.6  删除话题"></a>10.6  删除话题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.在a链接中设置href地址，地址中将id参数传入</span><br><span class="line">2.在ruter.js中,添加配置路由</span><br><span class="line">3.在topList.js文件中,处理配置路由函数代码</span><br><span class="line">4.在delete.js文件中,处理数据库代码</span><br></pre></td></tr></table></figure>
<p><code>show.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">将当前话题的id传入参数中</span><br><span class="line">&lt;a href=&quot;/topic/&#123;&#123;topic.id&#125;&#125;/delete&quot; id=&quot;delete_topic&quot;&gt;删除&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">当请求删除标识时,执行对应的函数处理代码</span><br><span class="line">// 3.配置路由</span><br><span class="line">// //渲染登录页面</span><br><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic)</span><br><span class="line">	.post(&apos;/topic/create&apos;,topic.createTopicHandle)</span><br><span class="line">	.get(&apos;/signout&apos;,user.signout)</span><br><span class="line">	// /detail/topic/:topicID:如果标识是动态的，动态变化的部分用 :+形参表示</span><br><span class="line">	.get(&apos;/detail/topic/:topicID&apos;,topic.topicDetail)</span><br><span class="line">	.get(&apos;/topic/:topicID/delete&apos;,topic.delete);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>fun/topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">函数逻辑处理代码</span><br><span class="line">// 删除话题</span><br><span class="line">exports.delete = (req,res) =&gt; &#123;</span><br><span class="line">	const topicID = req.params.topicID;</span><br><span class="line">	deleteData.delete(topicID,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code:500,</span><br><span class="line">				msg: &apos;服务器出错了&apos;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		res.redirect(&apos;/&apos;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>delete.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">数据库处理代码</span><br><span class="line">//mysql // 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;webkit&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">exports.delete = (id,callback) =&gt; &#123;</span><br><span class="line">	const sqlStr = &apos;delete from `topics` where id = ?&apos;;</span><br><span class="line">	connection.query(sqlStr,id,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			callback(error);</span><br><span class="line">		&#125;</span><br><span class="line">		callback(null,results);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-7-编辑话题-渲染页面"><a href="#10-7-编辑话题-渲染页面" class="headerlink" title="10.7  编辑话题-渲染页面"></a>10.7  编辑话题-渲染页面</h3><p><code>show.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;/topic/&#123;&#123;topic.id&#125;&#125;/edit&quot;&gt;编辑&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic)</span><br><span class="line">	.post(&apos;/topic/create&apos;,topic.createTopicHandle)</span><br><span class="line">	.get(&apos;/signout&apos;,user.signout)</span><br><span class="line">	// /detail/topic/:topicID:如果标识是动态的，动态变化的部分用 :+形参表示</span><br><span class="line">	.get(&apos;/detail/topic/:topicID&apos;,topic.topicDetail)</span><br><span class="line">	.get(&apos;/topic/:topicID/delete&apos;,topic.delete)</span><br><span class="line">	.get(&apos;/topic/:topicID/edit&apos;,topic.edit);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>topList.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 编辑话题</span><br><span class="line">exports.edit = (req,res) =&gt; &#123;</span><br><span class="line">	const topicID = req.params.topicID;</span><br><span class="line">	editData.edit(topicID,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code:500,</span><br><span class="line">				msg: &apos;服务器出错了&apos;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		渲染编辑页面</span><br><span class="line">		res.render(&apos;topic/edit.html&apos;,&#123;</span><br><span class="line">			topic: results[0]</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>edit.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//mysql // 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;webkit&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">exports.edit = (id,callback) =&gt; &#123;</span><br><span class="line">	const sqlStr = &apos;select * from `topics` where id = ?&apos;;</span><br><span class="line">	connection.query(sqlStr,id,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			callback(error);</span><br><span class="line">		&#125;</span><br><span class="line">		callback(null,results);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>edit.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;form id=&quot;form&quot; action=&quot;/topic/edit&quot;&gt;</span><br><span class="line">      &lt;!-- 表单隐藏域 --&gt;</span><br><span class="line">      &lt;input type=&quot;hidden&quot; id=&quot;topic_id&quot; value=&quot;&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">          &lt;label for=&quot;title&quot;&gt;标题&lt;/label&gt;</span><br><span class="line">          &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;title&quot; name=&quot;title&quot; value=&quot;&#123;&#123;topic.title&#125;&#125;&quot;&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">          &lt;label for=&quot;content&quot;&gt;内容&lt;/label&gt;</span><br><span class="line">          &lt;textarea class=&quot;form-control&quot; id=&quot;content&quot; name=&quot;content&quot; rows=&quot;10&quot;&gt;&#123;&#123;topic.content&#125;&#125;&lt;/textarea&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;提交&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h3 id="10-8-编辑话题-处理表单"><a href="#10-8-编辑话题-处理表单" class="headerlink" title="10.8  编辑话题-处理表单"></a>10.8  编辑话题-处理表单</h3><p><code>客户端发送表单提交 edit.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.获取id的方式可以在表单中添加隐藏项来设置topic.id</span><br><span class="line">2.可以在js中使用模板引擎获取id</span><br><span class="line">&lt;script&gt;</span><br><span class="line">     $(&apos;#form&apos;).on(&apos;submit&apos;,function(e)&#123;</span><br><span class="line">            var dataForm = $(this).serialize();</span><br><span class="line">            // var url = &quot;/topic/edit/&quot; + &#123;&#123;topic.id&#125;&#125;;</span><br><span class="line">            var url = &quot;/topic/edit/&quot; + &quot;&#123;&#123;topic.id&#125;&#125;&quot;;</span><br><span class="line">            $.post(url,dataForm,function(data)&#123;</span><br><span class="line">                // console.log(data);</span><br><span class="line">                if(data.code == 200)&#123;</span><br><span class="line">                    window.location.href = &apos;/detail/topic/&#123;&#123;topic.id&#125;&#125;&apos;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            e.preventDefault();</span><br><span class="line">     &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// //渲染登录页面</span><br><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic)</span><br><span class="line">	.post(&apos;/topic/create&apos;,topic.createTopicHandle)</span><br><span class="line">	.get(&apos;/signout&apos;,user.signout)</span><br><span class="line">	// /detail/topic/:topicID:如果标识是动态的，动态变化的部分用 :+形参表示</span><br><span class="line">	.get(&apos;/detail/topic/:topicID&apos;,topic.topicDetail)</span><br><span class="line">	.get(&apos;/topic/:topicID/delete&apos;,topic.delete)</span><br><span class="line">	.get(&apos;/topic/:topicID/edit&apos;,topic.edit)</span><br><span class="line">	.post(&apos;/topic/edit/:topicID&apos;,topic.editHandle);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>editHandle.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 修改话题处理</span><br><span class="line">exports.editHandle = (req,res) =&gt; &#123;</span><br><span class="line">	// 获取要修改的数据topicID</span><br><span class="line">	const topicID = req.params.topicID;</span><br><span class="line">	// 接收提交的数据</span><br><span class="line">	const body = req.body;</span><br><span class="line">	// console.log(body);</span><br><span class="line">	editHandle.editHandle(topicID,body,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 500,</span><br><span class="line">				msg: error.message</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		res.send(&#123;</span><br><span class="line">			code: 200,</span><br><span class="line">			msg: &quot;编辑成功&quot;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//mysql // 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;webkit&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">exports.edit = (id,callback) =&gt; &#123;</span><br><span class="line">	const sqlStr = &apos;select * from `topics` where id = ?&apos;;</span><br><span class="line">	connection.query(sqlStr,id,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			callback(error);</span><br><span class="line">		&#125;</span><br><span class="line">		callback(null,results);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="11-用户注册"><a href="#11-用户注册" class="headerlink" title="11.  用户注册"></a>11.  用户注册</h2><h3 id="11-1-渲染注册页面"><a href="#11-1-渲染注册页面" class="headerlink" title="11.1  渲染注册页面"></a>11.1  渲染注册页面</h3><p><code>signin.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;没有账号? &lt;a href=&quot;/signup&quot;&gt;点击创建&lt;/a&gt;.&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 3.配置路由</span><br><span class="line">// //渲染登录页面</span><br><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic)</span><br><span class="line">	.post(&apos;/topic/create&apos;,topic.createTopicHandle)</span><br><span class="line">	.get(&apos;/signout&apos;,user.signout)</span><br><span class="line">	// /detail/topic/:topicID:如果标识是动态的，动态变化的部分用 :+形参表示</span><br><span class="line">	.get(&apos;/detail/topic/:topicID&apos;,topic.topicDetail)</span><br><span class="line">	.get(&apos;/topic/:topicID/delete&apos;,topic.delete)</span><br><span class="line">	.get(&apos;/topic/:topicID/edit&apos;,topic.edit)</span><br><span class="line">	.post(&apos;/topic/edit/:topicID&apos;,topic.editHandle)</span><br><span class="line">	.get(&apos;/signup&apos;,user.signup);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>user.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 渲染注册页面</span><br><span class="line">exports.signup = (req,res) =&gt; &#123;</span><br><span class="line">	res.render(&apos;signup.html&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-2-客户端发送表单请求"><a href="#11-2-客户端发送表单请求" class="headerlink" title="11.2  客户端发送表单请求"></a>11.2  客户端发送表单请求</h3><p><code>signup.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(&apos;#signup_form&apos;).on(&apos;submit&apos;,function(e)&#123;</span><br><span class="line">    var data = $(this).serialize();</span><br><span class="line">    $.post(&apos;/signup&apos;,data,function(data)&#123;</span><br><span class="line">    	// console.log(data);</span><br><span class="line">    &#125;);</span><br><span class="line">    // 取消浏览器默认行为</span><br><span class="line">    // return false;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="11-3-服务端处理表单-获取表单数据"><a href="#11-3-服务端处理表单-获取表单数据" class="headerlink" title="11.3  服务端处理表单-获取表单数据"></a>11.3  服务端处理表单-获取表单数据</h3><p><code>router.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 3.配置路由</span><br><span class="line">// //渲染登录页面</span><br><span class="line">router.get(&apos;/login&apos;,user.login)</span><br><span class="line">	//处理登录页面表单逻辑</span><br><span class="line">	.post(&apos;/signin&apos;,user.handleLogin)</span><br><span class="line">	//渲染列表页面</span><br><span class="line">	.get(&apos;/&apos;,topic.list)</span><br><span class="line">	.get(&apos;/topic/create&apos;,topic.createTopic)</span><br><span class="line">	.post(&apos;/topic/create&apos;,topic.createTopicHandle)</span><br><span class="line">	.get(&apos;/signout&apos;,user.signout)</span><br><span class="line">	// /detail/topic/:topicID:如果标识是动态的，动态变化的部分用 :+形参表示</span><br><span class="line">	.get(&apos;/detail/topic/:topicID&apos;,topic.topicDetail)</span><br><span class="line">	.get(&apos;/topic/:topicID/delete&apos;,topic.delete)</span><br><span class="line">	.get(&apos;/topic/:topicID/edit&apos;,topic.edit)</span><br><span class="line">	//话题编辑表单处理</span><br><span class="line">	.post(&apos;/topic/edit/:topicID&apos;,topic.editHandle)</span><br><span class="line">	//注册页面请求</span><br><span class="line">	.get(&apos;/signup&apos;,user.signup)</span><br><span class="line">	//注册页面表单处理</span><br><span class="line">	.post(&apos;/signup&apos;,user.signUpHandle);</span><br><span class="line">// 4.导出成员</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p><code>user.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//注册页面表单数据渲染</span><br><span class="line">exports.signUpHandle = (req,res) =&gt; &#123;</span><br><span class="line">	//接收表单提交的数据</span><br><span class="line">	const body = req.body;</span><br><span class="line">	console.log(body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-4-服务端处理表单-验证邮箱和昵称"><a href="#11-4-服务端处理表单-验证邮箱和昵称" class="headerlink" title="11.4  服务端处理表单-验证邮箱和昵称"></a>11.4  服务端处理表单-验证邮箱和昵称</h3><p><code>user.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">接收注册表单提交的请求</span><br><span class="line">验证邮箱是否存在，如果不存在，则可以注册</span><br><span class="line">验证昵称是否存在，如果昵称不存在，则可以添加新用户</span><br></pre></td></tr></table></figure>
<p><code>user.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">//注册页面表单数据渲染</span><br><span class="line">exports.signUpHandle = (req,res) =&gt; &#123;</span><br><span class="line">	const body = req.body;</span><br><span class="line">	// console.log(body);</span><br><span class="line">	// 验证邮箱的代码与登录一样</span><br><span class="line">	userLogin.checkForm(body.email,(error,results) =&gt; &#123;</span><br><span class="line">		if(error) &#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 500,</span><br><span class="line">				msg: error.message</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		if(results[0]) &#123;</span><br><span class="line">			return res.send(&#123;</span><br><span class="line">				code: 1,</span><br><span class="line">				msg: &quot;邮箱已存在&quot;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		// 如果邮箱不存在，验证昵称</span><br><span class="line">		signUpHandle.signUpHandle(body.nickname,(error,results) =&gt; &#123;</span><br><span class="line">			if(error) &#123;</span><br><span class="line">				return res.send(&#123;</span><br><span class="line">					code: 500,</span><br><span class="line">					msg: error.message</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">			console.log(results);</span><br><span class="line">			if(results[0]) &#123;</span><br><span class="line">				return res.send(&#123;</span><br><span class="line">					code: 2,</span><br><span class="line">					msg: &quot;昵称已存在&quot;</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">			// 验证完邮箱和昵称之后，把数据添加到数据库</span><br><span class="line">			signUpHandle.signUpData(body,(error,results) =&gt; &#123;</span><br><span class="line">				if(error) &#123;</span><br><span class="line">					return res.send(&#123;</span><br><span class="line">						code: 500,</span><br><span class="line">						msg: error.message</span><br><span class="line">					&#125;);</span><br><span class="line">				&#125;</span><br><span class="line">				res.send(&#123;</span><br><span class="line">					code: 200,</span><br><span class="line">					msg: &quot;添加成功&quot;</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>signUpHandle.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//mysql // 1.导包</span><br><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">// 2.配置mysql</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : &apos;localhost&apos;,</span><br><span class="line">  user     : &apos;root&apos;,</span><br><span class="line">  password : &apos;root&apos;,</span><br><span class="line">  database : &apos;webkit&apos;</span><br><span class="line">&#125;);</span><br><span class="line">// 3.开启链接</span><br><span class="line">connection.connect();</span><br><span class="line">exports.signUpHandle = (data,callback) =&gt; &#123;</span><br><span class="line">	const sqlStr = &apos;select * from `users` where nickname = ?&apos;;</span><br><span class="line">	connection.query(sqlStr,data,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			callback(error);</span><br><span class="line">		&#125;</span><br><span class="line">		callback(null,results);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line">exports.signUpData = (data,callback) =&gt; &#123;</span><br><span class="line">	const sqlStr = &apos;insert into `users` set ?&apos;;</span><br><span class="line">	connection.query(sqlStr,data,(error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			callback(error);</span><br><span class="line">		&#125;</span><br><span class="line">		callback(null,results);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-5-客户端处理响应"><a href="#11-5-客户端处理响应" class="headerlink" title="11.5  客户端处理响应"></a>11.5  客户端处理响应</h3><p><code>signup.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        $(&apos;#signup_form&apos;).on(&apos;submit&apos;,function(e)&#123;</span><br><span class="line">            var data = $(this).serialize();</span><br><span class="line">            $.post(&apos;/signup&apos;,data,function(data)&#123;</span><br><span class="line">                // console.log(data);</span><br><span class="line">                if(data.code == 200)&#123;</span><br><span class="line">                    window.location.href = &apos;/login&apos;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            // 取消浏览器默认行为</span><br><span class="line">            // return false;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">        &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="12-处理中间件"><a href="#12-处理中间件" class="headerlink" title="12.  处理中间件"></a>12.  处理中间件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">中间件：是express框架的一个功能</span><br><span class="line">作用: 处理所有的请求和响应</span><br></pre></td></tr></table></figure>
<h3 id="12-1-中间件"><a href="#12-1-中间件" class="headerlink" title="12.1  中间件"></a>12.1  中间件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1.搭建服务器</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">const app = express();</span><br><span class="line">需求: 想输出所有请求的请求方法和请求标识</span><br><span class="line">任何请求都会监听到,不限定请求标识</span><br><span class="line">app.use((req,res,next) =&gt; &#123;</span><br><span class="line">    console.log(`$&#123;req.method&#125;,$&#123;req.path&#125;`);</span><br><span class="line">    调用next()方法:作用是把当前的请求交给下一个能匹配到的中间件继续处理</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line">app.get(&apos;/a&apos;,(req,res) =&gt; &#123;</span><br><span class="line">    res.send(&apos;aaa&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">app.get(&apos;/b&apos;,(req,res) =&gt; &#123;</span><br><span class="line">    res.send(&apos;bbb&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(12345,() =&gt; &#123;</span><br><span class="line">    console.log(&apos;run it---&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>app.use</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.use((req,res,next) =&gt; &#123;</span><br><span class="line">    处理当前请求并且执行下一个能匹配到的标识</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">next(): 把当前请求交给下一个能匹配到的中间件继续处理</span><br><span class="line">注意:</span><br><span class="line">app.use((req,res,next) =&gt; &#123;&#125;) 所有请求都会监听到</span><br><span class="line">next形参类型是函数 next()</span><br><span class="line">中间件的执行有顺序问题(从上到下一一匹配)</span><br></pre></td></tr></table></figure>
<h3 id="12-2-中间件-常用API方法"><a href="#12-2-中间件-常用API方法" class="headerlink" title="12.2  中间件-常用API方法"></a>12.2  中间件-常用API方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.处理所有请求</span><br><span class="line">app.use((req,res,next) =&gt; &#123;&#125;);</span><br><span class="line">2.处理标识为 /a 请求方式是get的请求</span><br><span class="line">app.get(&apos;/a&apos;,(req,res,next) =&gt; &#123;&#125;);</span><br><span class="line">3.处理标识为 /a 请求方式是post的请求</span><br><span class="line">app.post(&apos;/a&apos;,(req,res,next) =&gt; &#123;&#125;);</span><br><span class="line">4.处理标识以/a开头的所有请求   /a  /a/b   /abc</span><br><span class="line">app.use(&apos;/a&apos;,(req,res,next) =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="12-3-中间件-执行顺序"><a href="#12-3-中间件-执行顺序" class="headerlink" title="12.3  中间件-执行顺序"></a>12.3  中间件-执行顺序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.中间件的执行有顺序问题</span><br><span class="line">2.按照中间件写的位置从上到下一一匹配</span><br></pre></td></tr></table></figure>
<p><code>app.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app.use((req,res,next) =&gt; &#123;</span><br><span class="line">    console.log(`$&#123;req.method&#125;,$&#123;req.path&#125;`);</span><br><span class="line">    调用next()方法:作用是把当前的请求交给下一个能匹配到的中间件继续处理</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line">app.get(&apos;/a&apos;,(req,res) =&gt; &#123;</span><br><span class="line">    res.send(&apos;aaa&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">app.get(&apos;/b&apos;,(req,res) =&gt; &#123;</span><br><span class="line">    res.send(&apos;bbb&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(12345,() =&gt; &#123;</span><br><span class="line">    console.log(&apos;run it---&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">1.没有next形参</span><br><span class="line">如果匹配 /a标识，只会执行app.use(),因为没有next()方法,告诉下面的请求</span><br><span class="line">2.有next形参</span><br><span class="line">如果匹配 /a标识，不仅执行app.use(),而且执行下面的app.get(&apos;/b&apos;,(req,res)=&gt; &#123;&#125;);next()会执行下面的请求</span><br></pre></td></tr></table></figure>
<h3 id="12-4-中间件-给req增加属性"><a href="#12-4-中间件-给req增加属性" class="headerlink" title="12.4  中间件-给req增加属性"></a>12.4  中间件-给req增加属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.在第一个中间件给req增加属性body</span><br><span class="line">2.在下一个能匹配到的中间件中使用req.body属性</span><br><span class="line">3.项目中的包 body-parser原理也是如此</span><br></pre></td></tr></table></figure>
<p><code>app.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">app.use((req,res,next) =&gt; &#123;</span><br><span class="line">    console.log(`$&#123;req.method&#125;,$&#123;req.path&#125;`);</span><br><span class="line">    给req增加一个属性</span><br><span class="line">    req.obj = &#123;</span><br><span class="line">        name = &apos;cheng&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    调用next()方法:作用是把当前的请求交给下一个能匹配到的中间件继续处理</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line">app.get(&apos;/a&apos;,(req,res) =&gt; &#123;</span><br><span class="line">	获取到req中的属性</span><br><span class="line">	console.log(req.obj);</span><br><span class="line">    res.send(&apos;aaa&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">app.get(&apos;/b&apos;,(req,res) =&gt; &#123;</span><br><span class="line">    res.send(&apos;bbb&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(12345,() =&gt; &#123;</span><br><span class="line">    console.log(&apos;run it---&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="12-5-中间件-next参数"><a href="#12-5-中间件-next参数" class="headerlink" title="12.5  中间件-next参数"></a>12.5  中间件-next参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.use((req,res,next) =&gt; &#123;&#125;);</span><br><span class="line">处理函数可以有三个参数，请求对象、响应对象、next函数</span><br><span class="line">1.next形参 是函数</span><br><span class="line">2.next(); 作用:把当前请求交给下一个能匹配到的中间件</span><br></pre></td></tr></table></figure>
<h3 id="12-6-中间件-模拟express-static方法的实现"><a href="#12-6-中间件-模拟express-static方法的实现" class="headerlink" title="12.6  中间件-模拟express-static方法的实现"></a>12.6  中间件-模拟express-static方法的实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const app = express();</span><br><span class="line">app.use((req, res, next) =&gt; &#123;</span><br><span class="line">        const path = req.path;</span><br><span class="line">        fs.readFile(&quot;./public&quot; + path, &quot;utf8&quot;, (err, data) =&gt; &#123;</span><br><span class="line">            if (err) &#123;</span><br><span class="line">                //    throw err;</span><br><span class="line">                // 如果代码来到这 证明当前文件读不到 /a -&gt; res.send(&quot;aaaa&quot;);</span><br><span class="line">                return next();</span><br><span class="line">            &#125;</span><br><span class="line">            res.send(data);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">app.get(&quot;/a&quot;, (req, res, next) =&gt; &#123;</span><br><span class="line">    res.send(&quot;aaaaa&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(23456, () =&gt; &#123;</span><br><span class="line">    console.log(&quot;run it----&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const app = express();</span><br><span class="line">function static(filepath) &#123;</span><br><span class="line">    return (req, res, next) =&gt; &#123;</span><br><span class="line">        const path = req.path;</span><br><span class="line">        fs.readFile(filepath + path, &quot;utf8&quot;, (err, data) =&gt; &#123;</span><br><span class="line">            if (err) &#123;</span><br><span class="line">                //    throw err;</span><br><span class="line">                // 如果代码来到这 证明当前文件读不到 /a -&gt; res.send(&quot;aaaa&quot;);</span><br><span class="line">                return next();</span><br><span class="line">            &#125;</span><br><span class="line">            res.send(data);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">app.use(static(&quot;./public&quot;));</span><br><span class="line">app.get(&quot;/a&quot;, (req, res, next) =&gt; &#123;</span><br><span class="line">    res.send(&quot;aaaaa&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(23456, () =&gt; &#123;</span><br><span class="line">    console.log(&quot;run it----&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="12-7-中间件-next-传参数"><a href="#12-7-中间件-next-传参数" class="headerlink" title="12.7  中间件-next()-传参数"></a>12.7  中间件-next()-传参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.next函数不传参数</span><br><span class="line">next()</span><br><span class="line">2.next传参数</span><br><span class="line">next()实参要求是错误对象</span><br><span class="line">next()如果传了实参是错误对象，会匹配处理函数有4个参数的中间件</span><br><span class="line">4个参数的中间件 app.use((error,req,res,next) =&gt; &#123;&#125;)</span><br><span class="line">4个参数的中间件 其中error指的是next()的实参错误对象</span><br><span class="line">3.js的代码块</span><br><span class="line">try&#123;</span><br><span class="line">    把可能出现的错误代码放在这块儿</span><br><span class="line">&#125;catch(error)&#123;</span><br><span class="line">    如果try中代码确实出错,catch形参error就是错误对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>next实参</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">try&#123;</span><br><span class="line">    console.log(111);</span><br><span class="line">    JSON.parse(&apos;saf;hslafhdslak;f&apos;);   错误代码</span><br><span class="line">&#125;catch(error)&#123;</span><br><span class="line">	catch形参error就是try中代码的错误对象</span><br><span class="line">    console.log(222);</span><br><span class="line">    next(error);</span><br><span class="line">&#125;</span><br><span class="line">处理函数中4个参数 (错误对象，请求对象，响应对象，next方法)</span><br><span class="line">app.use((error,req,res,next) =&gt; &#123;</span><br><span class="line">    console.log(333);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="12-8-中间件作用和分类"><a href="#12-8-中间件作用和分类" class="headerlink" title="12.8  中间件作用和分类"></a>12.8  中间件作用和分类</h3><p><code>作用</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.执行任何代码</span><br><span class="line">2.修改request或者response响应对象   给req增加任意一个属性</span><br><span class="line">3.调用下一个中间件  next()</span><br><span class="line">4.可以发送响应 res.send()</span><br></pre></td></tr></table></figure>
<p><code>分类</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">应用程序级别中间件 app.use(express.static())</span><br><span class="line">路由级别中间件 express.Router()</span><br><span class="line">错误级别中间件 (err,req,res,next) =&gt; &#123;&#125;</span><br><span class="line">内置中间件 express.static()</span><br><span class="line">第三方中间件 body-parser express-session mogran serve-index</span><br></pre></td></tr></table></figure>
<h2 id="13-项目"><a href="#13-项目" class="headerlink" title="13.  项目"></a>13.  项目</h2><h3 id="13-1-统一处理-500-错误"><a href="#13-1-统一处理-500-错误" class="headerlink" title="13.1  统一处理-500-错误"></a>13.1  统一处理-500-错误</h3><p><code>topList.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">传入错误对象,如果出现错误,执行next(error);会匹配处理函数有4个参数的中间件</span><br><span class="line">// 渲染文章列表</span><br><span class="line">exports.list = (req,res,next) =&gt; &#123;</span><br><span class="line">	// 通过mysql获取列表数据</span><br><span class="line">	topList.showList((error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return next(error);</span><br><span class="line">		&#125;</span><br><span class="line">		res.render(&apos;index.html&apos;,&#123;</span><br><span class="line">			items: results,</span><br><span class="line">			user: req.session.user</span><br><span class="line">			// req.session.user   session中的数据</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>app.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 3.配置路由</span><br><span class="line">// // //配置路由1.2 使用路由 实例化</span><br><span class="line">app.use(router);</span><br><span class="line">匹配这个中间件</span><br><span class="line">app.use((error,req,res,next) =&gt; &#123;</span><br><span class="line">    res.send(&#123;</span><br><span class="line">        code:500,</span><br><span class="line">        msg:error.message</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="13-2-404页面的处理"><a href="#13-2-404页面的处理" class="headerlink" title="13.2  404页面的处理"></a>13.2  404页面的处理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 3.配置路由</span><br><span class="line">// // //配置路由1.2 使用路由 实例化</span><br><span class="line">app.use(router);</span><br><span class="line">// 渲染404页面</span><br><span class="line">对于router.js文件中 匹配不到的标识，会进行如下请求</span><br><span class="line">// 处理所有请求，如果前面的配置路由请求不到，则进行如下渲染</span><br><span class="line">app.use((req,res,next) =&gt; &#123;</span><br><span class="line">    res.render(&apos;404.html&apos;);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line">// 统一处理500错误的中间件</span><br><span class="line">app.use((error,req,res,next) =&gt; &#123;</span><br><span class="line">    res.send(&#123;</span><br><span class="line">        code:500,</span><br><span class="line">        msg:error.message</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="13-3-请求日志"><a href="#13-3-请求日志" class="headerlink" title="13.3  请求日志"></a>13.3  请求日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">输出项目中所有的请求日志</span><br><span class="line">1.app.use(req,res,next) =&gt; &#123;</span><br><span class="line">    console.log(req.method,req,path);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line">2.使用第三方来打印所有请求日志</span><br><span class="line">morgan:给所有功能输出日志</span><br><span class="line">1)安装</span><br><span class="line">	npm i morgan</span><br><span class="line">2）导入包</span><br><span class="line">	var morgan = require(&apos;morgan&apos;);</span><br><span class="line">3）配置</span><br><span class="line">	app.use(morgan(&apos;combined&apos;));</span><br><span class="line">	或者</span><br><span class="line">	app.use(morgan(&apos;tiny&apos;));</span><br><span class="line">	或者</span><br><span class="line">	app.use(morgan(&apos;:method :url :status :res[content-length] - :response-time ms&apos;));</span><br></pre></td></tr></table></figure>
<h3 id="13-4-公共成员的使用"><a href="#13-4-公共成员的使用" class="headerlink" title="13.4  公共成员的使用"></a>13.4  公共成员的使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app对象有一个属性locals,值类型是一个对象</span><br><span class="line">app.locals里面的成员num,num可以在页面文件中通过模板引擎的语法去使用</span><br><span class="line">app.locals.num = 100</span><br><span class="line">找html文件 &#123;&#123;num&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">将req.session中的数据保存在公共成员中</span><br><span class="line">app.locals</span><br><span class="line">app.use((req,res,next) =&gt; &#123;</span><br><span class="line">    app.locals.sessionUser = req.session.user;</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>user.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在模板引擎中，添加数据时，不需要user:req.session.user</span><br></pre></td></tr></table></figure>
<p><code>topList.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">exports.list = (req,res,next) =&gt; &#123;</span><br><span class="line">	// 通过mysql获取列表数据</span><br><span class="line">	topList.showList((error,results) =&gt; &#123;</span><br><span class="line">		if(error)&#123;</span><br><span class="line">			return next(error);</span><br><span class="line">		&#125;</span><br><span class="line">		res.render(&apos;index.html&apos;,&#123;</span><br><span class="line">			items: results</span><br><span class="line">			// user: req.session.user</span><br><span class="line">			// req.session.user   session中的数据</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>header.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt;</span><br><span class="line">    &#123;&#123;if sessionUser&#125;&#125;</span><br><span class="line">        &lt;a class=&quot;btn btn-default navbar-btn&quot; href=&quot;/topic/create&quot;&gt;发起&lt;/a&gt;</span><br><span class="line">             &lt;li class=&quot;dropdown&quot;&gt;</span><br><span class="line">                   &lt;a href=&quot;#&quot; class=&quot;dropdown-toggle&quot; data-toggle=&quot;dropdown&quot; role=&quot;button&quot; aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt;&lt;img width=&quot;20&quot; height=&quot;20&quot; src=&quot;../public/img/avatar-max-img.png&quot; alt=&quot;&quot;&gt; &lt;span class=&quot;caret&quot;&gt;&lt;/span&gt;&lt;/a&gt;</span><br><span class="line">                   &lt;ul class=&quot;dropdown-menu&quot;&gt;</span><br><span class="line">                        &lt;li class=&quot;dropdown-current-user&quot;&gt;</span><br><span class="line">                            当前登录用户:&#123;&#123;sessionUser.nickname&#125;&#125;</span><br><span class="line">                        &lt;/li&gt;</span><br><span class="line">                        &lt;li role=&quot;separator&quot; class=&quot;divider&quot;&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=&quot;#&quot;&gt;个人主页&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=&quot;/settings/profile&quot;&gt;设置&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=&quot;/signout&quot;&gt;退出&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                    &lt;/ul&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">    &#123;&#123;else&#125;&#125;</span><br><span class="line">          &lt;a class=&quot;btn btn-primary navbar-btn&quot; href=&quot;/login&quot;&gt;登录&lt;/a&gt;</span><br><span class="line">          &lt;a class=&quot;btn btn-success navbar-btn&quot; href=&quot;/signup&quot;&gt;注册&lt;/a&gt;</span><br><span class="line">    &#123;&#123;/if&#125;&#125;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p><code>show.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;if topic.userId === sessionUser.id&#125;&#125;</span><br><span class="line">     &lt;a href=&quot;/topic/&#123;&#123;topic.id&#125;&#125;/edit&quot;&gt;编辑&lt;/a&gt;</span><br><span class="line">     &lt;a href=&quot;/topic/&#123;&#123;topic.id&#125;&#125;/delete&quot; id=&quot;delete_topic&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">&#123;&#123;/if&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="14-ES6-展开运算符"><a href="#14-ES6-展开运算符" class="headerlink" title="14. ES6-展开运算符"></a>14. ES6-展开运算符</h2><p><code>数组</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1.const arr= [1,2,3];</span><br><span class="line">const temp = [...arr];</span><br><span class="line">console.log(temp);   1 2 3</span><br><span class="line">2.拼接数组</span><br><span class="line">1）const arr = [1,2,3,4];</span><br><span class="line">const arr1 = [1,2,3,4,5];</span><br><span class="line">console.log(arr.concat(arr1));</span><br><span class="line">2）const arr = [1,2,3,4];</span><br><span class="line">const arr1 = [1,2,3,4,5];</span><br><span class="line">const arr2 = [...arr,...arr1];</span><br><span class="line">console.log(arr2);</span><br><span class="line">3.合并对象</span><br><span class="line">const per = &#123;</span><br><span class="line">	name: &apos;zhangsan&apos;</span><br><span class="line">&#125;</span><br><span class="line">const per1 = &#123;</span><br><span class="line">	age: 10</span><br><span class="line">&#125;</span><br><span class="line">const per2 = &#123;</span><br><span class="line">	...per,</span><br><span class="line">	...per1</span><br><span class="line">&#125;</span><br><span class="line">console.log(per2);</span><br><span class="line">4. 数组去重</span><br><span class="line">const arr = [1,2,2,3,3,6,5,5,5,4,4];</span><br><span class="line">const set = new Set(arr);</span><br><span class="line">console.log(set);</span><br><span class="line">Set集合 是ES6新数据类型</span><br></pre></td></tr></table></figure>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">搜索网站 国内、国际   https://cn.bing.com</span><br><span class="line">自动格式化时间  momentjs.com</span><br></pre></td></tr></table></figure>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">windows wox+everything</span><br><span class="line">多窗口终端 windows conemu/cmd/Powershell/Xshell/cmder</span><br></pre></td></tr></table></figure>
<h3 id="web扩展"><a href="#web扩展" class="headerlink" title="web扩展"></a>web扩展</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">phoneGap打包|React-Native</span><br><span class="line">PC端:考虑各个浏览器 各个浏览器各个版本</span><br><span class="line">苹果</span><br><span class="line">安卓</span><br><span class="line">代码版本控制工具: git|svn</span><br></pre></td></tr></table></figure>
<h3 id="客户端发送表单请求"><a href="#客户端发送表单请求" class="headerlink" title="客户端发送表单请求"></a>客户端发送表单请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">form: 默认提交 传数据 同步 整个页面都刷新</span><br><span class="line">ajax post 传数据 异步 页面局部刷新</span><br></pre></td></tr></table></figure>
<h3 id="页面重定向"><a href="#页面重定向" class="headerlink" title="页面重定向"></a>页面重定向</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务端重定向： res.redirect(&apos;/&apos;);   只适用于同步请求(form表单)</span><br><span class="line">客户端重定向:  window.location.href = &apos;&apos;;   适用于异步请求 比如说ajax请求 是异步的。这种方式不能服务端重定向，只能返回响应，让客户端重定向</span><br></pre></td></tr></table></figure>
<h3 id="GET和POST"><a href="#GET和POST" class="headerlink" title="GET和POST"></a>GET和POST</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.场景： get 查询 post:上传/添加</span><br><span class="line">2.安全性： post比get安全性好  POST:请求体 GET:URL中</span><br></pre></td></tr></table></figure>
<h3 id="文件扩充"><a href="#文件扩充" class="headerlink" title="文件扩充"></a>文件扩充</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.psd : ps切图文件</span><br><span class="line">.prd :产品需求文档</span><br></pre></td></tr></table></figure>
<h3 id="VSCode快捷键"><a href="#VSCode快捷键" class="headerlink" title="VSCode快捷键"></a>VSCode快捷键</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">选中相同代码 ctrl+D</span><br><span class="line">行尾行首来回跳 Fn + 左|右</span><br><span class="line">选中一个单词 ctrl+shift+左|右</span><br><span class="line">垂直方向选中 ctrl+alt+上</span><br><span class="line">关闭目录 ctrl+b</span><br><span class="line">分屏 ctrl+alt+左|右</span><br><span class="line">到文件所在目录 shift+alt+r</span><br></pre></td></tr></table></figure>
      </div>
        <div class="support-author">
          <p>感谢您的阅读。 🙏
          <a href target="_blank">关于转载请看这里</a>
            <!--<a class="btn-pay"  href="#pay-modal">¥ 打赏支持</a>-->
          </p>
        </div>
        <!--
            <div class="like ">
              <div class="like-button">
                <a id="like-note" href="">
                  <i class="icon-heart"></i>喜欢
                </a>
              </div>
              <span id="likes-count">256</span>
            </div>
        -->
        <div class="otherLink">
          <div class="previous">
          </div>
          <div class="next">
          </div>
        </div>
        <div class="comments" id="comments">
          
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
  const gitalk = new Gitalk({
    clientID: '8888a8888',
    clientSecret: '8888886666666',
    repo: 'xxxx.github.io',
    owner: 'admin',
    admin: ['admin'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false
  })

  gitalk.render('comments');
</script>


        </div>
      </div>
    </div>
   
</main>
<div class="footer">
  <div class="info">
    <p>
    <a href="https://hexo.io"> Hexo </a> 强力驱动 |
      <a href="https://github.com/Youthink/hexo-themes-yearn"> Yearn </a>
      主题
    </p>
    <p>&copy;2013-2018 Ren Fang的博客 京ICP备xxxxxx号</p>
  </div>
</div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>//console
  var consoleConfig = '\n欢迎访问 https://hufangyun.com ，围观小猿大圣的博客(づ｡◕‿‿◕｡)づ！\n,\n本博客使用 %cHexo%c 搭建，博客主题为小猿大圣开发的 %chexo-themes-yearn%c ~~~ 🎉🎉🎉 \n\n源码 https://github.com/Youthink/hexo-themes-yearn \n\n如果喜欢可以 star 支持一下 ❤️~\n'.split(',');
  var canConsole = true;
  var consoleInfo = (function(consoleConfig) {
  if (!canConsole || !consoleConfig || consoleConfig.length < 1) {
    return;
  }
  var consoleColor = '#6190e8';
  var _console;
  var backgroundTextStyle = 'padding: 1px 5px;color: #fff;background: ' + consoleColor + ';'
  var textStyle = 'color: ' + consoleColor + ';';

  consoleConfig.map(o => {
    var num = (o.match(/%c/g) || []).length;
    if(/^http(s)?:\/\//.test(o)) {
      console.log('%c     ', 'background: url(' + o + ') no-repeat left center;font-size: 180px;');
      return;
    }
    if (num > 0) {
      var logArguments = [];
      for (var i = 0; i < num; i++) {
        if (i % 2 === 0) {
          logArguments.push(backgroundTextStyle);
        } else {
          logArguments.push(textStyle);
        }
      }
      (_console = console).log.apply(_console, ['%c' + o, textStyle].concat(logArguments));
      return;
    }
    console.log('%c' + o, textStyle);
  });
}(consoleConfig));</script><script type="text/javascript" src="/songfang0/./js/main.d9e3dd.js"></script>

</body>
</html>
